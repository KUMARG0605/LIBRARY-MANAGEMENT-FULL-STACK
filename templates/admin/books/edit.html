{% extends "base.html" %}

{% block title %}Edit Book - Admin{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2 class="mb-1">Edit Book</h2>
                    <p class="text-muted">Update book information</p>
                </div>
                <a href="{{ url_for('admin.books') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Back to Books
                </a>
            </div>

            <!-- Edit Form -->
            <div class="card shadow-sm">
                <div class="card-body">
                    <form method="POST" action="{{ url_for('admin.edit_book', book_id=book.id) }}" enctype="multipart/form-data">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        
                        <!-- Basic Information -->
                        <h5 class="mb-3 text-primary">
                            <i class="fas fa-info-circle me-2"></i>Basic Information
                        </h5>
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="isbn" class="form-label">ISBN *</label>
                                    <input type="text" class="form-control" id="isbn" name="isbn" 
                                           value="{{ book.isbn }}" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="title" class="form-label">Title *</label>
                                    <input type="text" class="form-control" id="title" name="title" 
                                           value="{{ book.title }}" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="author" class="form-label">Author *</label>
                                    <input type="text" class="form-control" id="author" name="author" 
                                           value="{{ book.author }}" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="publisher" class="form-label">Publisher</label>
                                    <input type="text" class="form-control" id="publisher" name="publisher" 
                                           value="{{ book.publisher }}">
                                </div>
                            </div>
                        </div>

                        <!-- Classification -->
                        <h5 class="mb-3 text-primary">
                            <i class="fas fa-tag me-2"></i>Classification
                        </h5>
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="category" class="form-label">Category *</label>
                                    <select class="form-select" id="category" name="category" required>
                                        <option value="">Select Category</option>
                                        {% for cat in categories %}
                                        <option value="{{ cat.name }}" {% if book.category == cat.name %}selected{% endif %}>
                                            {{ cat.name }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="department" class="form-label">Department</label>
                                    <select class="form-select" id="department" name="department">
                                        <option value="">Select Department</option>
                                        {% for dept in departments %}
                                        <option value="{{ dept.name }}" {% if book.department == dept.name %}selected{% endif %}>
                                            {{ dept.name }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="language" class="form-label">Language</label>
                                    <select class="form-select" id="language" name="language">
                                        <option value="English" {% if book.language == 'English' %}selected{% endif %}>English</option>
                                        <option value="Hindi" {% if book.language == 'Hindi' %}selected{% endif %}>Hindi</option>
                                        <option value="Spanish" {% if book.language == 'Spanish' %}selected{% endif %}>Spanish</option>
                                        <option value="French" {% if book.language == 'French' %}selected{% endif %}>French</option>
                                        <option value="German" {% if book.language == 'German' %}selected{% endif %}>German</option>
                                        <option value="Other" {% if book.language == 'Other' %}selected{% endif %}>Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="shelf_location" class="form-label">Shelf Location</label>
                                    <input type="text" class="form-control" id="shelf_location" name="shelf_location" 
                                           value="{{ book.shelf_location }}" placeholder="e.g., A-12-5">
                                </div>
                            </div>
                        </div>

                        <!-- Publication Details -->
                        <h5 class="mb-3 text-primary">
                            <i class="fas fa-calendar me-2"></i>Publication Details
                        </h5>
                        <div class="row mb-4">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="publication_year" class="form-label">Publication Year</label>
                                    <input type="number" class="form-control" id="publication_year" name="publication_year" 
                                           value="{{ book.publication_year }}" min="1000" max="2100">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="pages" class="form-label">Number of Pages</label>
                                    <input type="number" class="form-control" id="pages" name="pages" 
                                           value="{{ book.pages }}" min="1">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="edition" class="form-label">Edition</label>
                                    <input type="text" class="form-control" id="edition" name="edition" 
                                           value="{{ book.edition }}" placeholder="e.g., 1st, 2nd">
                                </div>
                            </div>
                        </div>

                        <!-- Inventory -->
                        <h5 class="mb-3 text-primary">
                            <i class="fas fa-boxes me-2"></i>Inventory
                        </h5>
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="total_copies" class="form-label">Total Copies *</label>
                                    <input type="number" class="form-control" id="total_copies" name="total_copies" 
                                           value="{{ book.total_copies }}" min="1" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="price" class="form-label">Price (â‚¹)</label>
                                    <input type="number" class="form-control" id="price" name="price" 
                                           value="{{ book.price }}" step="0.01" min="0">
                                </div>
                            </div>
                        </div>

                        <!-- Description -->
                        <h5 class="mb-3 text-primary">
                            <i class="fas fa-align-left me-2"></i>Description
                        </h5>
                        <div class="mb-4">
                            <textarea class="form-control" id="description" name="description" rows="4" 
                                      placeholder="Brief description of the book">{{ book.description }}</textarea>
                        </div>

                        <!-- Cover Image -->
                        <h5 class="mb-3 text-primary">
                            <i class="fas fa-image me-2"></i>Cover Image
                        </h5>
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="cover_image" class="form-label">Upload New Cover (optional)</label>
                                    <input type="file" class="form-control" id="cover_image" name="cover_image" 
                                           accept="image/*">
                                    <small class="text-muted">Recommended size: 300x400px. JPG or PNG format.</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                {% if book.cover_image %}
                                <label class="form-label">Current Cover</label>
                                <div>
                                    <img src="{{ url_for('static', filename='images/books/' + book.cover_image) }}" 
                                         alt="{{ book.title }}" class="img-thumbnail" style="max-height: 150px;">
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Status -->
                        <div class="mb-4">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="is_active" name="is_active" 
                                       {% if book.is_active %}checked{% endif %}>
                                <label class="form-check-label" for="is_active">
                                    Active (visible to users)
                                </label>
                            </div>
                        </div>

                        <!-- Submit Buttons -->
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>Save Changes
                            </button>
                            <a href="{{ url_for('admin.books') }}" class="btn btn-secondary">
                                <i class="fas fa-times me-2"></i>Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
